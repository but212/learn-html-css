#!/bin/bash
# Git post-merge hook: 절대 경로를 상대 경로로 변환 (src 및 루트 index.html 포함)

echo "🔄 Merging into main... Updating paths!"

# 변경할 대상 디렉토리 및 파일 지정
TARGET_DIR="src"
TARGET_FILE="index.html"
EXTENSIONS=("js" "ts" "html" "css")

# 절대 경로 찾기
ABSOLUTE_PATH=$(realpath "$TARGET_DIR")

# src 디렉토리 내부의 절대 경로 수정
find "$TARGET_DIR" -type f \( $(printf -- '-name "*.%s" -o ' "${EXTENSIONS[@]}" | sed 's/ -o $//') \) | while read -r file; do
    echo "🔄 Updating paths in: $file"
    sed -i "s|$ABSOLUTE_PATH|./$TARGET_DIR|g" "$file"
done

# 루트 index.html 파일에 적용
if [ -f "$TARGET_FILE" ]; then
    echo "🔄 Updating paths in: $TARGET_FILE"
    sed -i "s|$ABSOLUTE_PATH|./$TARGET_DIR|g" "$TARGET_FILE"
fi

echo "✅ Paths updated successfully!"
